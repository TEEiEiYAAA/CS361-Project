<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>เว็บปฏิทิน</title>
  <link rel="stylesheet" href="./CSS/calendar.css" />
  <script src='./JS/fullcalendar.js'></script>
</head>
<body>
    <header class="header">
        <div class="logo">AchieveHub</div>
        <div class="nav-container">
            <nav class="nav-menu">
                <a href="advisor-dashboard.html" class="nav-button">หน้าแรก</a>
                <a href="advisor-activities.html" class="nav-button">ตรวจสอบกิจกรรม</a>
                <a href="advisor-calender.html" class="nav-button active">ปฏิทินกิจกรรม</a>
                <a href="add-activity.html" class="nav-button">เพิ่มกิจกรรม</a>
            </nav>
            <div class="logout-icon" id="user-icon" onclick="logout()">
                <img src="./Image/LogOut.png" />
            </div>
        </div>
    </header>

  <main>
    <div id="calendar"></div>
  </main>

  <footer>
    <p>AchieveHub ©2025<br>CS361</p>
    <small>นางสาวธวัลหทัย เทียมทอง 6609650111 นางสาวกนกพร พรรณปัญญา 6609650152 นายกุลเศรษฐ์ เนตรเพชร 6609650194 นางสาวชลธาร ศิลปาจารย์ 6609650269 นายธีรัตม์ ศรีสุโข 6609650442 นายปริญ จิระมหาโภคี 6609650475</small>
    </footer>

<script>
    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');
      const API_URL = 'https://mb252cstbb.execute-api.us-east-1.amazonaws.com/prod/activities';

      // ★★★ 1. (ใหม่) อัปเดต "ชุดสีพาสเทล" เป็น 8 สี ★★★
      // และบังคับตัวอักษรสีดำทั้งหมด
      const colorPalette = [
        { bg: '#AEC6CF', text: '#000000' }, // ฟ้าพาสเทล
        { bg: '#BDECB6', text: '#000000' }, // เขียวพาสเทล
        { bg: '#FFD1A1', text: '#000000' }, // ส้มพาสเทล
        { bg: '#FFB6C1', text: '#000000' }, // ชมพูพาสเทล (แดงอ่อน)
        { bg: '#C3B1E1', text: '#000000' },  // ม่วงพาสเทล
        { bg: '#ACE7E2', text: '#000000' }  // เขียวน้ำทะเล
      ];

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'th',
        height: 'auto',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,listWeek'
        },

        events: async function (fetchInfo, successCallback, failureCallback) {
          try {
            const response = await fetch(API_URL);
            let raw = await response.json();
            let activities = raw;
            if (raw && typeof raw === 'object' && !Array.isArray(raw) && 'body' in raw) {
              activities = typeof raw.body === 'string' ? JSON.parse(raw.body) : raw.body;
            }
            if (!Array.isArray(activities)) {
              throw new Error("Data received is not an array");
            }

            // แปลงข้อมูล (Mapping)
            const transformedEvents = activities.map(function (activity) {

              // ★★★ 2. สร้าง "Hash" จาก activityId (หรือ name) ★★★
              let hash = 0;
              const idString = activity.activityId || activity.name || '';
              if (idString.length === 0) {
                hash = 0;
              } else {
                for (let i = 0; i < idString.length; i++) {
                  const char = idString.charCodeAt(i);
                  hash = ((hash << 5) - hash) + char;
                  hash = hash & hash; // Convert to 32bit integer
                }
              }
              hash = Math.abs(hash);

              // 3. นำ hash มา % (mod) กับจำนวนสี (ตอนนี้คือ 8)
              const colorSet = colorPalette[hash % colorPalette.length];

              // ★★★ 4. กำหนดสีพื้นหลัง (color) และสีตัวอักษร (textColor) ★★★
              return {
                id: activity.activityId,
                title: activity.name,
                start: activity.startDateTime,
                end: activity.endDateTime,
                color: colorSet.bg,       // <-- สีพื้นหลังพาสเทล
                textColor: colorSet.text, // <-- สีตัวอักษรดำ
                extendedProps: {
                  description: activity.description,
                  location: activity.locationName || activity.locationId,
                  skillCategory: activity.skillCategory,
                  level: activity.level || activity.skillLevel
                }
              };
            });

            successCallback(transformedEvents);

          } catch (error) {
            console.error('Error fetching or transforming activities:', error);
            failureCallback(error);
          }
        },

        eventClick: function (info) {
          alert('กิจกรรม: ' + info.event.title + '\n' +
            'รายละเอียด: ' + (info.event.extendedProps.description || 'ไม่มี') + '\n' +
            'สถานที่: ' + (info.event.extendedProps.location || 'ไม่มี'));
        }
      });

      calendar.render();
    });
  </script>
</body>

</html>